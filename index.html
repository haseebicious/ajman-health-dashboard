<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ajman Health & Food Safety Dashboard</title>
  <link rel="icon" href="assets/ajman-data-logo.png" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; background: #f5f7fa; color: #2c3e50; margin: 0; }
    .header { display: flex; align-items: center; justify-content: space-between; background: linear-gradient(135deg, #1e3a5f 0%, #2c5282 100%); color: white; padding: 1.5rem 2rem; }
    .header .logos { display: flex; gap: 1.5rem; align-items: center; }
    .header img { height: 56px; background: white; border-radius: 8px; padding: 3px; }
    .header h1 { font-size: 2rem; margin: 0 0 0 1rem; }
    .lang-toggle { font-size: 1rem; }
    .lang-toggle button { background: #fff; color: #1e3a5f; border: none; font-weight: bold; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; margin-left: 0.5rem; }
    .lang-toggle button.active { background: #7c3aed; color: #fff; }
    .metrics-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem; padding: 2rem; max-width: 1400px; margin: 0 auto; }
    .metric-card { background: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.08); text-align: center; }
    .metric-title { color: #7c3aed; font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem; }
    .metric-value { font-size: 2.1rem; font-weight: 700; color: #1e3a5f; }
    .charts-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 2rem; padding: 0 2rem 2rem; max-width: 1400px; margin: 0 auto; }
    .chart-card { background: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    .chart-card h3 { font-size: 1.15rem; margin-bottom: 1rem; color: #1e3a5f; }
    .chart-container { position: relative; height: 320px; }
    .chart-narrative { font-size: 0.95rem; margin-top: 0.5rem; color: #444; }
    .insights-section { background: white; margin: 2rem; padding: 2rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); max-width: 1360px; margin: 2rem auto; }
    .insights-section h2 { color: #1e3a5f; margin-bottom: 1.5rem; font-size: 1.3rem; }
    .insight-item { display: flex; align-items: flex-start; margin-bottom: 1.2rem; padding: 1rem; background: #f8fafc; border-radius: 8px; border-left: 4px solid #7c3aed; }
    .insight-icon { font-size: 1.5rem; margin-right: 1rem; }
    .insight-text h4 { color: #1e3a5f; margin-bottom: 0.5rem; }
    .footer { background: #1e3a5f; color: white; padding: 1.5rem; text-align: center; margin-top: 2rem; }
    .footer p { margin: 0.5rem 0; opacity: 0.9; }
    .footer a { color: #93c5fd; text-decoration: underline; }
    .footer a:hover { text-decoration: underline; }
    @media (max-width: 768px) {
      .header { flex-direction: column; align-items: flex-start; }
      .charts-container { grid-template-columns: 1fr; }
      .metrics-container { grid-template-columns: 1fr; }
      .header img { height: 40px; }
    }
  </style>
</head>
<body>
  <div class="header" id="header">
    <div class="logos">
      <img src="assets/ajman-data-logo.png" alt="Ajman Data Logo" />
      <img src="assets/ajman-vision-2030-logo.png" alt="Ajman Vision 2030 Logo" />
      <h1 id="dashboardTitle"></h1>
    </div>
    <div class="lang-toggle" id="langToggle">
      <button id="enBtn" class="active" onclick="setLang('en')">English</button>
      <button id="arBtn" onclick="setLang('ar')">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</button>
    </div>
  </div>
  <p id="dashboardSubtitle" style="text-align:center; margin:1rem 0 0.5rem;"></p>
  <div class="metrics-container" id="metricsContainer"></div>
  <div class="charts-container" id="chartsContainer"></div>
  <div class="insights-section" id="insightsSection">
    <h2 id="insightsTitle"></h2>
    <div id="insightsList"></div>
  </div>
  <div class="footer">
    <p id="footerSource"></p>
    <p id="footerVision"></p>
    <p>
      <a href="https://drive.google.com/file/d/117tCPxZFDSuK42dQhU_oRK0INWZ8Su2k/view" target="_blank">
        Ajman Vision 2030 [PDF] | ÿ±ÿ§Ÿäÿ© ÿπÿ¨ŸÖÿßŸÜ 2030 [ŸÖŸÑŸÅ PDF]
      </a>
    </p>
    <p>Created by Haseeb Juma | ¬© 2025 - Ajman University</p>
  </div>
  <script>
    // === BILINGUAL TRANSLATION OBJECT ===
    const translations = {
      en: {
        dashboardTitle: "Ajman Health & Food Safety Dashboard",
        dashboardSubtitle: "Empowering Ajman‚Äôs Future: Data-Driven Health for All",
        metrics: [
          { title: "Shops Inspected" },
          { title: "Food Safety Pass Rate" },
          { title: "Violations Issued" },
          { title: "Products Confiscated" },
          { title: "Export Certificates" }
        ],
        charts: [
          "Medical Certificates Issued (Export & Veterinary)",
          "Food Laboratory Test Results (Fit vs Unfit)",
          "Confiscated Food & Health Products (kg)",
          "Warnings & Violations by Category",
          "Shops Visited for Inspection"
        ],
        chartNarratives: [
          "Ajman‚Äôs export and veterinary health certification activity over time. Export certifications dominate, reflecting Ajman‚Äôs strong food export oversight.",
          "Food safety testing results: steady improvement in 'Fit' samples, with a declining trend in 'Unfit' results, supporting Vision 2030 sustainability.",
          "Confiscated product volumes indicate active enforcement. Spikes often follow increased inspections or targeted campaigns.",
          "Most violations are issued to companies, suggesting targeted education/enforcement could yield quick wins for public health.",
          "Inspection activity shows Ajman‚Äôs preventive approach to health and food safety, with peaks during high-risk periods."
        ],
        insightsTitle: "Key Insights & Vision 2030 Alignment",
        insights: [
          {
            icon: "üå±",
            title: "Sustainability in Action",
            text: "Reduction in unsafe food and increased preventive enforcement support Ajman‚Äôs sustainability goals."
          },
          {
            icon: "ü§ù",
            title: "Community Well-being",
            text: "Transparent health data empowers citizens and supports inclusive, healthy communities."
          },
          {
            icon: "üí°",
            title: "Innovation for Impact",
            text: "Real-time, interactive analytics enable evidence-based policy and government excellence."
          },
          {
            icon: "üìà",
            title: "Human Capital Development",
            text: "Open data and insights foster education, research, and a future-ready society."
          }
        ],
        footerSource: "Data Source: Ajman Data Portal (data.ajman.ae)",
        footerVision: "Aligned with Ajman Vision 2030 for a sustainable, healthy, and inclusive future."
      },
      ar: {
        dashboardTitle: "ŸÑŸàÿ≠ÿ© ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿµÿ≠ÿ© Ÿàÿ≥ŸÑÿßŸÖÿ© ÿßŸÑÿ∫ÿ∞ÿßÿ° ÿπÿ¨ŸÖÿßŸÜ",
        dashboardSubtitle: "ÿ™ŸÖŸÉŸäŸÜ ŸÖÿ≥ÿ™ŸÇÿ®ŸÑ ÿπÿ¨ŸÖÿßŸÜ: ÿßŸÑÿµÿ≠ÿ© ŸÑŸÑÿ¨ŸÖŸäÿπ ÿ®ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™",
        metrics: [
          { title: "ÿßŸÑŸÖÿ≠ŸÑÿßÿ™ ÿßŸÑÿ™Ÿä ÿ™ŸÖ ÿ™ŸÅÿ™Ÿäÿ¥Ÿáÿß" },
          { title: "ŸÖÿπÿØŸÑ ŸÜÿ¨ÿßÿ≠ ÿ≥ŸÑÿßŸÖÿ© ÿßŸÑÿ£ÿ∫ÿ∞Ÿäÿ©" },
          { title: "ÿßŸÑŸÖÿÆÿßŸÑŸÅÿßÿ™ ÿßŸÑÿµÿßÿØÿ±ÿ©" },
          { title: "ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿßŸÑŸÖÿµÿßÿØÿ±ÿ©" },
          { title: "ÿ¥ŸáÿßÿØÿßÿ™ ÿßŸÑÿ™ÿµÿØŸäÿ±" }
        ],
        charts: [
          "ÿßŸÑÿ¥ŸáÿßÿØÿßÿ™ ÿßŸÑÿµÿ≠Ÿäÿ© ÿßŸÑÿµÿßÿØÿ±ÿ© (ÿ™ÿµÿØŸäÿ± Ÿàÿ®Ÿäÿ∑ÿ±Ÿäÿ©)",
          "ŸÜÿ™ÿßÿ¶ÿ¨ ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ŸÖÿÆÿ™ÿ®ÿ± ÿßŸÑÿ£ÿ∫ÿ∞Ÿäÿ© (ÿµÿßŸÑÿ≠ÿ©/ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠ÿ©)",
          "ÿßŸÑŸÖŸàÿßÿØ ÿßŸÑÿ∫ÿ∞ÿßÿ¶Ÿäÿ© ŸàÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿßŸÑÿµÿ≠Ÿäÿ© ÿßŸÑŸÖÿµÿßÿØÿ±ÿ© (ŸÉÿ¨ŸÖ)",
          "ÿßŸÑÿ•ŸÜÿ∞ÿßÿ±ÿßÿ™ ŸàÿßŸÑŸÖÿÆÿßŸÑŸÅÿßÿ™ ÿ≠ÿ≥ÿ® ÿßŸÑŸÅÿ¶ÿ©",
          "ÿßŸÑŸÖÿ≠ŸÑÿßÿ™ ÿßŸÑÿ™Ÿä ÿ™ŸÖÿ™ ÿ≤Ÿäÿßÿ±ÿ™Ÿáÿß ŸÑŸÑÿ™ŸÅÿ™Ÿäÿ¥"
        ],
        chartNarratives: [
          "ŸÜÿ¥ÿßÿ∑ ÿ•ÿµÿØÿßÿ± ÿßŸÑÿ¥ŸáÿßÿØÿßÿ™ ÿßŸÑÿµÿ≠Ÿäÿ© ŸÑŸÑÿ™ÿµÿØŸäÿ± ŸàÿßŸÑÿ®Ÿäÿ∑ÿ±Ÿäÿ© ŸÅŸä ÿπÿ¨ŸÖÿßŸÜ ÿπÿ®ÿ± ÿßŸÑÿ≥ŸÜŸàÿßÿ™. ÿ¥ŸáÿßÿØÿßÿ™ ÿßŸÑÿ™ÿµÿØŸäÿ± ÿ™ÿ™ÿµÿØÿ± ÿßŸÑŸÖÿ¥ŸáÿØÿå ŸÖŸÖÿß ŸäÿπŸÉÿ≥ ÿßŸÑÿ±ŸÇÿßÿ®ÿ© ÿßŸÑŸÇŸàŸäÿ© ÿπŸÑŸâ ÿßŸÑÿ™ÿµÿØŸäÿ± ÿßŸÑÿ∫ÿ∞ÿßÿ¶Ÿä.",
          "ŸÜÿ™ÿßÿ¶ÿ¨ ÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ÿ≥ŸÑÿßŸÖÿ© ÿßŸÑÿ£ÿ∫ÿ∞Ÿäÿ©: ÿ™ÿ≠ÿ≥ŸÜ ŸÖÿ≥ÿ™ŸÖÿ± ŸÅŸä ÿßŸÑÿπŸäŸÜÿßÿ™ ÿßŸÑÿµÿßŸÑÿ≠ÿ© Ÿàÿ™ÿ±ÿßÿ¨ÿπ ŸÅŸä ÿ∫Ÿäÿ± ÿßŸÑÿµÿßŸÑÿ≠ÿ©ÿå ÿØÿπŸÖŸãÿß ŸÑÿßÿ≥ÿ™ÿØÿßŸÖÿ© ÿ±ÿ§Ÿäÿ© ÿπÿ¨ŸÖÿßŸÜ 2030.",
          "ŸÉŸÖŸäÿßÿ™ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿßŸÑŸÖÿµÿßÿØÿ±ÿ© ÿ™ÿπŸÉÿ≥ ŸÅÿπÿßŸÑŸäÿ© ÿßŸÑÿ•ŸÜŸÅÿßÿ∞. ÿßŸÑÿßÿ±ÿ™ŸÅÿßÿπÿßÿ™ ÿ∫ÿßŸÑÿ®Ÿãÿß ŸÖÿß ÿ™ÿ™ÿ®ÿπ ÿ≠ŸÖŸÑÿßÿ™ ÿ™ŸÅÿ™Ÿäÿ¥ ÿ£Ÿà ÿ≠ŸÖŸÑÿßÿ™ ŸÖŸàÿ¨Ÿáÿ©.",
          "ŸÖÿπÿ∏ŸÖ ÿßŸÑŸÖÿÆÿßŸÑŸÅÿßÿ™ ÿ™ÿµÿØÿ± ŸÑŸÑÿ¥ÿ±ŸÉÿßÿ™ÿå ŸÖŸÖÿß Ÿäÿ¥Ÿäÿ± ÿ•ŸÑŸâ ÿ£ŸÜ ÿßŸÑÿ™ŸàÿπŸäÿ© ÿ£Ÿà ÿßŸÑÿ•ŸÜŸÅÿßÿ∞ ÿßŸÑŸÖŸàÿ¨Ÿá ŸÇÿØ Ÿäÿ≠ŸÇŸÇ ŸÜÿ™ÿßÿ¶ÿ¨ ÿ≥ÿ±Ÿäÿπÿ© ŸÑŸÑÿµÿ≠ÿ© ÿßŸÑÿπÿßŸÖÿ©.",
          "ŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ™ŸÅÿ™Ÿäÿ¥ ŸäŸèÿ∏Ÿáÿ± ŸÜŸáÿ¨ ÿπÿ¨ŸÖÿßŸÜ ÿßŸÑŸàŸÇÿßÿ¶Ÿä ŸÅŸä ÿßŸÑÿµÿ≠ÿ© Ÿàÿ≥ŸÑÿßŸÖÿ© ÿßŸÑÿ∫ÿ∞ÿßÿ° ŸÖÿπ ÿ∞ÿ±Ÿàÿßÿ™ ŸÅŸä ÿßŸÑŸÅÿ™ÿ±ÿßÿ™ ÿπÿßŸÑŸäÿ© ÿßŸÑŸÖÿÆÿßÿ∑ÿ±."
        ],
        insightsTitle: "ÿ±ÿ§Ÿâ ÿ±ÿ¶Ÿäÿ≥Ÿäÿ© ŸàŸÖÿ≠ÿßÿ∞ÿßÿ© ŸÖÿπ ÿ±ÿ§Ÿäÿ© ÿπÿ¨ŸÖÿßŸÜ 2030",
        insights: [
          {
            icon: "üå±",
            title: "ÿßŸÑÿßÿ≥ÿ™ÿØÿßŸÖÿ© ŸÇŸäÿØ ÿßŸÑÿ™ŸÜŸÅŸäÿ∞",
            text: "ÿßŸÜÿÆŸÅÿßÿ∂ ÿßŸÑÿ£ÿ∫ÿ∞Ÿäÿ© ÿ∫Ÿäÿ± ÿßŸÑÿµÿßŸÑÿ≠ÿ© Ÿàÿ≤ŸäÿßÿØÿ© ÿßŸÑÿ•ŸÜŸÅÿßÿ∞ ÿßŸÑŸàŸÇÿßÿ¶Ÿä ŸäÿØÿπŸÖ ÿ£ŸáÿØÿßŸÅ ÿßŸÑÿßÿ≥ÿ™ÿØÿßŸÖÿ© ŸÅŸä ÿπÿ¨ŸÖÿßŸÜ."
          },
          {
            icon: "ü§ù",
            title: "ÿ±ŸÅÿßŸáŸäÿ© ÿßŸÑŸÖÿ¨ÿ™ŸÖÿπ",
            text: "ÿßŸÑÿ¥ŸÅÿßŸÅŸäÿ© ŸÅŸä ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿµÿ≠ÿ© ÿ™ŸÖŸÉŸëŸÜ ÿßŸÑŸÖŸàÿßÿ∑ŸÜŸäŸÜ Ÿàÿ™ÿØÿπŸÖ ŸÖÿ¨ÿ™ŸÖÿπÿßÿ™ ÿµÿ≠Ÿäÿ© ÿ¥ÿßŸÖŸÑÿ©."
          },
          {
            icon: "üí°",
            title: "ÿßŸÑÿßÿ®ÿ™ŸÉÿßÿ± ŸÖŸÜ ÿ£ÿ¨ŸÑ ÿßŸÑÿ™ÿ£ÿ´Ÿäÿ±",
            text: "ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑÿßÿ™ ÿßŸÑÿ™ŸÅÿßÿπŸÑŸäÿ© ŸÅŸä ÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÅÿπŸÑŸä ÿ™ŸÖŸÉŸÜ ÿßŸÑÿ≥Ÿäÿßÿ≥ÿßÿ™ ÿßŸÑŸÖÿ®ŸÜŸäÿ© ÿπŸÑŸâ ÿßŸÑÿ£ÿØŸÑÿ© ŸàÿßŸÑÿ™ŸÖŸäÿ≤ ÿßŸÑÿ≠ŸÉŸàŸÖŸä."
          },
          {
            icon: "üìà",
            title: "ÿ™ÿ∑ŸàŸäÿ± ÿ±ÿ£ÿ≥ ÿßŸÑŸÖÿßŸÑ ÿßŸÑÿ®ÿ¥ÿ±Ÿä",
            text: "ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖŸÅÿ™Ÿàÿ≠ÿ© ŸàÿßŸÑÿ±ÿ§Ÿâ ÿ™ÿØÿπŸÖ ÿßŸÑÿ™ÿπŸÑŸäŸÖ ŸàÿßŸÑÿ®ÿ≠ÿ´ ŸàŸÖÿ¨ÿ™ŸÖÿπ ÿßŸÑŸÖÿ≥ÿ™ŸÇÿ®ŸÑ."
          }
        ],
        footerSource: "ÿßŸÑŸÖÿµÿØÿ±: ÿ®Ÿàÿßÿ®ÿ© ÿ®ŸäÿßŸÜÿßÿ™ ÿπÿ¨ŸÖÿßŸÜ (data.ajman.ae)",
        footerVision: "ÿ™ŸÖÿßÿ¥ŸäÿßŸã ŸÖÿπ ÿ±ÿ§Ÿäÿ© ÿπÿ¨ŸÖÿßŸÜ 2030 ŸÑŸÖÿ≥ÿ™ŸÇÿ®ŸÑ ŸÖÿ≥ÿ™ÿØÿßŸÖ Ÿàÿµÿ≠Ÿä Ÿàÿ¥ÿßŸÖŸÑ."
      }
    };

    let currentLang = 'en';

    function setLang(lang) {
      currentLang = lang;
      document.documentElement.lang = lang;
      document.documentElement.dir = (lang === 'ar') ? 'rtl' : 'ltr';
      document.getElementById('enBtn').classList.toggle('active', lang === 'en');
      document.getElementById('arBtn').classList.toggle('active', lang === 'ar');
      document.getElementById('dashboardTitle').textContent = translations[lang].dashboardTitle;
      document.getElementById('dashboardSubtitle').textContent = translations[lang].dashboardSubtitle;
      document.getElementById('insightsTitle').textContent = translations[lang].insightsTitle;
      document.getElementById('footerSource').textContent = translations[lang].footerSource;
      document.getElementById('footerVision').textContent = translations[lang].footerVision;
      renderMetrics();
      renderCharts();
      renderInsights();
    }

    // === DATA LOADING ===
    const files = {
      certificates: 'data/medical-certificates-issued.csv',
      foodLab: 'data/food-laboratory-test-results.csv',
      confiscated: 'data/confiscated-food-and-health-products.csv',
      violations: 'data/warnings-and-public-health-violations.csv',
      shops: 'data/shops-visited.csv'
    };
    let dataStore = {};

    Promise.all(Object.entries(files).map(([k, url]) =>
      fetch(url).then(r => r.text()).then(txt => [k, Papa.parse(txt, {header:true, skipEmptyLines:true}).data])
    )).then(results => {
      results.forEach(([k, d]) => dataStore[k] = d);
      setLang(currentLang);
    });

    // === METRICS CARDS ===
    function renderMetrics() {
      const metrics = [];
      // 1. Shops Inspected
      const shops = dataStore.shops || [];
      const totalShops = shops.reduce((sum, row) => sum + (parseFloat(row["Number of Shops Visited"]) || 0), 0);
      metrics.push({
        title: translations[currentLang].metrics[0].title,
        value: totalShops.toLocaleString()
      });
      // 2. Food Safety Pass Rate
      const foodLab = dataStore.foodLab || [];
      const fit = foodLab.filter(r => r["Analysis Results_EN"] === "Fit" || r["Analysis Results_AR"] === "ÿµÿßŸÑÿ≠ÿ©")
        .reduce((sum, row) => sum + (parseFloat(row.value) || 0), 0);
      const unfit = foodLab.filter(r => r["Analysis Results_EN"] === "Unfit" || r["Analysis Results_AR"] === "ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠ÿ©")
        .reduce((sum, row) => sum + (parseFloat(row.value) || 0), 0);
      const passRate = (fit + unfit) > 0 ? (fit / (fit + unfit) * 100).toFixed(1) : "0";
      metrics.push({
        title: translations[currentLang].metrics[1].title,
        value: passRate + "%"
      });
      // 3. Violations Issued
      const violations = dataStore.violations || [];
      const totalViol = violations.reduce((sum, row) => sum + (parseFloat(row["Number Of Violations And Cleanliness Issued By Waste Management &Public Higiene Sec"]) || 0), 0);
      metrics.push({
        title: translations[currentLang].metrics[2].title,
        value: totalViol.toLocaleString()
      });
      // 4. Products Confiscated
      const conf = dataStore.confiscated || [];
      const totalConf = conf.reduce((sum, row) => sum + (parseFloat(row["Confiscated food and health products(kg)"]) || 0), 0);
      metrics.push({
        title: translations[currentLang].metrics[3].title,
        value: (totalConf/1000).toFixed(1) + " t"
      });
      // 5. Export Certificates
      const cert = dataStore.certificates || [];
      const totalExport = cert.filter(r => (r.Category_EN === "Export CoH issued" || r.Category_AR === "ÿ¥ŸáÿßÿØÿßÿ™ ÿµÿ≠Ÿäÿ© ÿ™ÿµÿØŸäÿ±"))
        .reduce((sum, row) => sum + (parseFloat(row["Number of Certificates of Health"]) || 0), 0);
      metrics.push({
        title: translations[currentLang].metrics[4].title,
        value: totalExport.toLocaleString()
      });
      document.getElementById('metricsContainer').innerHTML = metrics.map(m =>
        `<div class="metric-card"><div class="metric-title">${m.title}</div><div class="metric-value">${m.value}</div></div>`
      ).join('');
    }

    // === CHARTS ===
    let chartInstances = [];
    function renderCharts() {
      chartInstances.forEach(ch => ch.destroy && ch.destroy());
      chartInstances = [];
      const chartsDiv = document.getElementById('chartsContainer');
      chartsDiv.innerHTML = '';
      // 1. Medical Certificates Chart
      const cert = dataStore.certificates || [];
      const certByYear = {};
      cert.forEach(row => {
        let year = parseInt(row.Year);
        if (isNaN(year)) return;
        year = String(year);
        const cat = (currentLang === 'ar' ? row.Category_AR : row.Category_EN) || '';
        const count = parseFloat(row["Number of Certificates of Health"]) || 0;
        if (!cat) return;
        if (!certByYear[year]) certByYear[year] = {Export:0, Veterinary:0};
        if (cat.includes(currentLang === 'ar' ? 'ÿ™ÿµÿØŸäÿ±' : 'Export')) certByYear[year].Export += count;
        else if (cat.includes(currentLang === 'ar' ? 'ÿ®Ÿäÿ∑ÿ±Ÿäÿ©' : 'Veterinary')) certByYear[year].Veterinary += count;
      });
      const yearsCert = Object.keys(certByYear).sort();
      const exportData = yearsCert.map(y => certByYear[y].Export);
      const vetData = yearsCert.map(y => certByYear[y].Veterinary);
      chartsDiv.innerHTML += `<div class="chart-card"><h3>${translations[currentLang].charts[0]}</h3><div class="chart-container"><canvas id="certificatesChart"></canvas></div><div class="chart-narrative">${translations[currentLang].chartNarratives[0]}</div></div>`;
      chartInstances.push(new Chart(document.getElementById('certificatesChart').getContext('2d'), {
        type: 'line',
        data: {
          labels: yearsCert,
          datasets: [
            {label: currentLang === 'ar' ? 'ÿ™ÿµÿØŸäÿ±' : 'Export', data: exportData, borderColor: '#007bff', fill:false, tension:0.3},
            {label: currentLang === 'ar' ? 'ÿ®Ÿäÿ∑ÿ±Ÿäÿ©' : 'Veterinary', data: vetData, borderColor: '#28a745', fill:false, tension:0.3}
          ]
        },
        options: {responsive:true, plugins: {legend: {position: 'top'}}, scales: {y: {beginAtZero:true}}}
      }));
      // 2. Food Laboratory Test Results Chart
      const foodLab = dataStore.foodLab || [];
      const foodByYear = {};
      foodLab.forEach(row => {
        let year = parseInt(row.year || row.Year);
        if (isNaN(year)) return;
        year = String(year);
        const result = (currentLang === 'ar' ? row["Analysis Results_AR"] : row["Analysis Results_EN"]) || '';
        const val = parseFloat(row.value) || 0;
        if (!result) return;
        if (!foodByYear[year]) foodByYear[year] = {Fit:0, Unfit:0};
        if (result === (currentLang === 'ar' ? 'ÿµÿßŸÑÿ≠ÿ©' : 'Fit')) foodByYear[year].Fit += val;
        else if (result === (currentLang === 'ar' ? 'ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠ÿ©' : 'Unfit')) foodByYear[year].Unfit += val;
      });
      const yearsFood = Object.keys(foodByYear).sort();
      const fitData = yearsFood.map(y => foodByYear[y].Fit);
      const unfitData = yearsFood.map(y => foodByYear[y].Unfit);
      chartsDiv.innerHTML += `<div class="chart-card"><h3>${translations[currentLang].charts[1]}</h3><div class="chart-container"><canvas id="foodLabChart"></canvas></div><div class="chart-narrative">${translations[currentLang].chartNarratives[1]}</div></div>`;
      chartInstances.push(new Chart(document.getElementById('foodLabChart').getContext('2d'), {
        type: 'bar',
        data: {
          labels: yearsFood,
          datasets: [
            {label: currentLang === 'ar' ? 'ÿµÿßŸÑÿ≠ÿ©' : 'Fit', data: fitData, backgroundColor: '#28a745'},
            {label: currentLang === 'ar' ? 'ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠ÿ©' : 'Unfit', data: unfitData, backgroundColor: '#dc3545'}
          ]
        },
        options: {responsive:true, plugins: {legend: {position: 'top'}}, scales: {y: {beginAtZero:true}, x: {stacked:true}}, interaction: {mode: 'index', intersect: false}, stacked: true}
      }));
      // 3. Confiscated Food & Health Products Chart
      const conf = dataStore.confiscated || [];
      const confByYear = {};
      conf.forEach(row => {
        let year = parseInt(row.Year);
        if (isNaN(year)) return;
        year = String(year);
        const val = parseFloat(row["Confiscated food and health products(kg)"]) || 0;
        confByYear[year] = (confByYear[year] || 0) + val;
      });
      const yearsConf = Object.keys(confByYear).sort();
      const confData = yearsConf.map(y => confByYear[y]);
      chartsDiv.innerHTML += `<div class="chart-card"><h3>${translations[currentLang].charts[2]}</h3><div class="chart-container"><canvas id="confiscatedChart"></canvas></div><div class="chart-narrative">${translations[currentLang].chartNarratives[2]}</div></div>`;
      chartInstances.push(new Chart(document.getElementById('confiscatedChart').getContext('2d'), {
        type: 'line',
        data: {
          labels: yearsConf,
          datasets: [{
            label: currentLang === 'ar' ? 'ÿßŸÑŸÖÿµÿßÿØÿ±ÿßÿ™ (ŸÉÿ¨ŸÖ)' : 'Confiscated (kg)',
            data: confData,
            borderColor: '#ffc107',
            fill: true,
            backgroundColor: 'rgba(255, 193, 7, 0.3)',
            tension: 0.3
          }]
        },
        options: {responsive:true, plugins: {legend: {position: 'top'}}, scales: {y: {beginAtZero:true}}}
      }));
      // 4. Warnings & Violations by Category
      const violations = dataStore.violations || [];
      const violByYearCat = {};
      violations.forEach(row => {
        let year = parseInt(row.Year);
        if (isNaN(year)) return;
        year = String(year);
        const cat = (currentLang === 'ar' ? row.Category_AR : row.Category_EN) || 'Other';
        const val = parseFloat(row["Number Of Violations And Cleanliness Issued By Waste Management &Public Higiene Sec"]) || 0;
        if (!violByYearCat[cat]) violByYearCat[cat] = {};
        violByYearCat[cat][year] = (violByYearCat[cat][year] || 0) + val;
      });
      const yearsViol = [...new Set(violations.map(r => {
        let y = parseInt(r.Year);
        return isNaN(y) ? null : String(y);
      }).filter(Boolean))].sort();
      const categories = Object.keys(violByYearCat);
      const datasetsViol = categories.map((cat, i) => ({
        label: cat,
        data: yearsViol.map(y => violByYearCat[cat][y] || 0),
        backgroundColor: ['#007bff','#28a745','#dc3545','#ffc107','#6f42c1'][i % 5]
      }));
      chartsDiv.innerHTML += `<div class="chart-card"><h3>${translations[currentLang].charts[3]}</h3><div class="chart-container"><canvas id="violationsChart"></canvas></div><div class="chart-narrative">${translations[currentLang].chartNarratives[3]}</div></div>`;
      chartInstances.push(new Chart(document.getElementById('violationsChart').getContext('2d'), {
        type: 'bar',
        data: { labels: yearsViol, datasets: datasetsViol },
        options: {responsive:true, plugins: {legend: {position: 'top'}}, scales: {y: {beginAtZero:true}, x: {stacked:true}}, interaction: {mode: 'index', intersect: false}, stacked: true}
      }));
      // 5. Shops Visited Chart
      const shops = dataStore.shops || [];
      const shopsByYear = {};
      shops.forEach(row => {
        let year = parseInt(row.Year);
        if (isNaN(year)) return;
        year = String(year);
        const val = parseFloat(row["Number of Shops Visited"]) || 0;
        shopsByYear[year] = (shopsByYear[year] || 0) + val;
      });
      const yearsShops = Object.keys(shopsByYear).sort();
      const shopsData = yearsShops.map(y => shopsByYear[y]);
      chartsDiv.innerHTML += `<div class="chart-card"><h3>${translations[currentLang].charts[4]}</h3><div class="chart-container"><canvas id="shopsChart"></canvas></div><div class="chart-narrative">${translations[currentLang].chartNarratives[4]}</div></div>`;
      chartInstances.push(new Chart(document.getElementById('shopsChart').getContext('2d'), {
        type: 'line',
        data: {
          labels: yearsShops,
          datasets: [{
            label: currentLang === 'ar' ? 'ÿπÿØÿØ ÿßŸÑŸÖÿ≠ŸÑÿßÿ™' : 'Shops Visited',
            data: shopsData,
            borderColor: '#17a2b8',
            fill: false,
            tension: 0.3
          }]
        },
        options: {responsive:true, plugins: {legend: {position: 'top'}}, scales: {y: {beginAtZero:true}}}
      }));
    }

    // === INSIGHTS ===
    function renderInsights() {
      const insights = translations[currentLang].insights;
      document.getElementById('insightsList').innerHTML = insights.map(ins =>
        `<div class="insight-item"><div class="insight-icon">${ins.icon}</div><div class="insight-text"><h4>${ins.title}</h4><p>${ins.text}</p></div></div>`
      ).join('');
    }
  </script>
</body>
</html>
